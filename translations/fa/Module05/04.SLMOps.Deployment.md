<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "ad0c054ebd3de404d997d1707a513c70",
  "translation_date": "2025-09-17T15:54:31+00:00",
  "source_file": "Module05/04.SLMOps.Deployment.md",
  "language_code": "fa"
}
-->
# ุจุฎุด ด: ูพุงุฏูโุณุงุฒ ูุฏู ุขูุงุฏู ุชููุฏ

## ูุฑูุฑ ฺฉู

ุงู ุขููุฒุด ุฌุงูุน ุดูุง ุฑุง ุงุฒ ุทุฑู ูุฑุขูุฏ ฺฉุงูู ุงุณุชูุฑุงุฑ ูุฏูโูุง ฺฉูููโุณุงุฒ ุดุฏู ู ุชูุธูโุดุฏู ุจุง ุงุณุชูุงุฏู ุงุฒ Foundry Local ุฑุงูููุง ูโฺฉูุฏ. ูุง ุชุจุฏู ูุฏูุ ุจูููโุณุงุฒ ฺฉูููโุณุงุฒ ู ูพฺฉุฑุจูุฏ ุงุณุชูุฑุงุฑ ุฑุง ุงุฒ ุงุจุชุฏุง ุชุง ุงูุชูุง ูพูุดุด ุฎูุงูู ุฏุงุฏ.

## ูพุดโูุงุฒูุง

ูุจู ุงุฒ ุดุฑูุนุ ูุทูุฆู ุดูุฏ ฺฉู ููุงุฑุฏ ุฒุฑ ุฑุง ุฏุงุฑุฏ:

- โ ฺฉ ูุฏู ุชูุธูโุดุฏู onnx ุขูุงุฏู ุจุฑุง ุงุณุชูุฑุงุฑ
- โ ฺฉุงููพูุชุฑ ููุฏูุฒ ุง ูฺฉ
- โ ูพุงุชูู ูุณุฎู 3.10 ุง ุจุงูุงุชุฑ
- โ ุญุฏุงูู ธ ฺฏฺฏุงุจุงุช ุฑู ููุฌูุฏ
- โ Foundry Local ูุตุจ ุดุฏู ุจุฑ ุฑู ุณุณุชู ุดูุง

## ุจุฎุด ฑ: ุชูุธู ูุญุท

### ูุตุจ ุงุจุฒุงุฑูุง ููุฑุฏ ูุงุฒ

ุชุฑููุงู ุฎูุฏ ุฑุง ุจุงุฒ ฺฉูุฏ (Command Prompt ุฏุฑ ููุฏูุฒุ Terminal ุฏุฑ ูฺฉ) ู ุฏุณุชูุฑุงุช ุฒุฑ ุฑุง ุจู ุชุฑุชุจ ุงุฌุฑุง ฺฉูุฏ:

```bash
# Update transformers library to the latest version
pip install transformers -U

# Install Microsoft Olive (model conversion tool)
pip install git+https://github.com/microsoft/Olive.git

# Install ONNX Runtime GenAI
git clone https://github.com/microsoft/onnxruntime-genai
cd onnxruntime-genai && python build.py --config Release
pip install {Your build release path}/onnxruntime_genai-0.9.0.dev0-cp311-cp311-linux_x86_64.whl

# Install additional dependencies
pip install onnx onnxruntime numpy
```

โ๏ธ **ูฺฉุชู ููู**: ุดูุง ููฺูู ุจู ูุณุฎู 3.31 ุง ุฌุฏุฏุชุฑ CMake ูุงุฒ ุฏุงุฑุฏ ฺฉู ูโุชูุงูุฏ ุขู ุฑุง ุงุฒ [cmake.org](https://cmake.org/download/) ุฏุงูููุฏ ฺฉูุฏ.

## ุจุฎุด ฒ: ุชุจุฏู ูุฏู ู ฺฉูููโุณุงุฒ

### ุงูุชุฎุงุจ ูุฑูุช ููุงุณุจ

ุจุฑุง ูุฏูโูุง ฺฉูฺฺฉ ุฒุจุงู ุชูุธูโุดุฏูุ ูุง ุงุณุชูุงุฏู ุงุฒ ูุฑูุช **ONNX** ุฑุง ุชูุตู ูโฺฉูู ุฒุฑุง:

- ๐ ุจูููโุณุงุฒ ุนููฺฉุฑุฏ ุจูุชุฑ
- ๐ง ุงุณุชูุฑุงุฑ ูุณุชูู ุงุฒ ุณุฎุชโุงูุฒุงุฑ
- ๐ญ ูุงุจูุชโูุง ุขูุงุฏู ุชููุฏ
- ๐ฑ ุณุงุฒฺฏุงุฑ ุจู ูพูุชูุฑูโูุง

### ุฑูุด ฑ: ุชุจุฏู ุจุง ฺฉ ุฏุณุชูุฑ (ุชูุตูโุดุฏู)

ุงุฒ ุฏุณุชูุฑ ุฒุฑ ุจุฑุง ุชุจุฏู ูุณุชูู ูุฏู ุชูุธูโุดุฏู ุฎูุฏ ุงุณุชูุงุฏู ฺฉูุฏ:

```bash
olive auto-opt \
    --model_name_or_path /path/to/your/finetuned/model \
    --device cpu \
    --provider CPUExecutionProvider \
    --use_model_builder \
    --precision int4 \
    --output_path models/your-model-name/onnx \
    --log_level 1
```

**ุชูุถุญ ูพุงุฑุงูุชุฑูุง:**
- `--model_name_or_path`: ูุณุฑ ูุฏู ุชูุธูโุดุฏู ุดูุง
- `--device cpu`: ุงุณุชูุงุฏู ุงุฒ CPU ุจุฑุง ุจูููโุณุงุฒ
- `--precision int4`: ุงุณุชูุงุฏู ุงุฒ ฺฉูููโุณุงุฒ INT4 (ฺฉุงูุด ุงูุฏุงุฒู ุชูุฑุจุงู ทตูช)
- `--output_path`: ูุณุฑ ุฎุฑูุฌ ุจุฑุง ูุฏู ุชุจุฏูโุดุฏู

### ุฑูุด ฒ: ุงุณุชูุงุฏู ุงุฒ ูุงู ูพฺฉุฑุจูุฏ (ุจุฑุง ฺฉุงุฑุจุฑุงู ูพุดุฑูุชู)

ฺฉ ูุงู ูพฺฉุฑุจูุฏ ุจู ูุงู `finetuned_conversion_config.json` ุงุฌุงุฏ ฺฉูุฏ:

```json
{
    "input_model": {
        "type": "HfModel",
        "model_path": "/path/to/your/finetuned/model",
        "task": "text-generation"
    },
    "systems": {
        "local_system": {
            "type": "LocalSystem",
            "accelerators": [
                {
                    "execution_providers": [
                        "CPUExecutionProvider"
                    ]
                }
            ]
        }
    },
    "passes": {
        "builder": {
            "type": "ModelBuilder",
            "config": {
                "precision": "int4",
                "quantization_config": {
                    "block_size": 128,
                    "is_symmetric": false
                }
            }
        }
    },
    "host": "local_system",
    "target": "local_system",
    "cache_dir": "cache",
    "output_dir": "models/output/your-finetuned-model-onnx"
}
```

ุณูพุณ ุงุฌุฑุง ฺฉูุฏ:

```bash
olive run --config ./finetuned_conversion_config.json
```

### ููุงุณู ฺฏุฒููโูุง ฺฉูููโุณุงุฒ

| ุฏูุช       | ุงูุฏุงุฒู ูุงู | ุณุฑุนุช ุงุณุชูุชุงุฌ | ฺฉูุช ูุฏู | ุงุณุชูุงุฏู ุชูุตูโุดุฏู |
|-----------|------------|---------------|-----------|--------------------|
| FP16      | ูพุงู ร 0.5 | ุณุฑุน          | ุจูุชุฑู    | ุณุฎุชโุงูุฒุงุฑ ูพุดุฑูุชู |
| INT8      | ูพุงู ร 0.25 | ุจุณุงุฑ ุณุฑุน   | ุฎูุจ       | ุงูุชุฎุงุจ ูุชุนุงุฏู     |
| INT4      | ูพุงู ร 0.125 | ุณุฑุนโุชุฑู    | ูุงุจู ูุจูู | ููุงุจุน ูุญุฏูุฏ       |

๐ก **ุชูุตู**: ุจุฑุง ุงููู ุงุณุชูุฑุงุฑ ุฎูุฏ ุจุง ฺฉูููโุณุงุฒ INT4 ุดุฑูุน ฺฉูุฏ. ุงฺฏุฑ ฺฉูุช ุฑุถุงุชโุจุฎุด ูุจูุฏุ INT8 ุง FP16 ุฑุง ุงูุชุญุงู ฺฉูุฏ.

## ุจุฎุด ณ: ูพฺฉุฑุจูุฏ ุงุณุชูุฑุงุฑ Foundry Local

### ุงุฌุงุฏ ูพฺฉุฑุจูุฏ ูุฏู

ุจู ุฏุงุฑฺฉุชูุฑ ูุฏูโูุง Foundry Local ุจุฑูุฏ:

```bash
foundry cache cd ./models/
```

ุณุงุฎุชุงุฑ ุฏุงุฑฺฉุชูุฑ ูุฏู ุฎูุฏ ุฑุง ุงุฌุงุฏ ฺฉูุฏ:

```bash
mkdir -p ./models/custom/your-finetuned-model
```

ูุงู ูพฺฉุฑุจูุฏ `inference_model.json` ุฑุง ุฏุฑ ุฏุงุฑฺฉุชูุฑ ูุฏู ุฎูุฏ ุงุฌุงุฏ ฺฉูุฏ:

```json
{
  "Name": "your-finetuned-model-int4",
  "Description": "Fine-tuned quantized model",
  "Version": "1.0",
  "PromptTemplate": {
    "system": "<|im_start|>system\n{Content}<|im_end|>",
    "user": "<|im_start|>user\n{Content}<|im_end|>",
    "assistant": "<|im_start|>assistant\n{Content}<|im_end|>",
    "prompt": "<|im_start|>user\n{Content}<|im_end|>\n<|im_start|>assistant"
  },
  "ModelConfig": {
    "max_length": 2048,
    "temperature": 0.7,
    "top_p": 0.9,
    "repetition_penalty": 1.1
  }
}
```

### ูพฺฉุฑุจูุฏโูุง ูุงูุจ ูุฎุตูุต ูุฏู

#### ุจุฑุง ูุฏูโูุง ุณุฑ Qwen:

```json
{
  "Name": "qwen-finetuned-int4",
  "PromptTemplate": {
    "system": "<|im_start|>system\n{Content}<|im_end|>",
    "user": "<|im_start|>user\n{Content}<|im_end|>",
    "assistant": "<|im_start|>assistant\n{Content}<|im_end|>",
    "prompt": "<|im_start|>user\n{Content}<|im_end|>\n<|im_start|>assistant"
  }
}
```

## ุจุฎุด ด: ุขุฒูุงุด ู ุจูููโุณุงุฒ ูุฏู

### ุจุฑุฑุณ ูุตุจ ูุฏู

ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุขุง Foundry Local ูโุชูุงูุฏ ูุฏู ุดูุง ุฑุง ุดูุงุณุง ฺฉูุฏ:

```bash
foundry cache ls
```

ุดูุง ุจุงุฏ `your-finetuned-model-int4` ุฑุง ุฏุฑ ูุณุช ูุดุงูุฏู ฺฉูุฏ.

### ุดุฑูุน ุขุฒูุงุด ูุฏู

```bash
foundry model run your-finetuned-model-int4
```

### ุงุฑุฒุงุจ ุนููฺฉุฑุฏ

ุฏุฑ ุทูู ุขุฒูุงุดุ ูุนุงุฑูุง ฺฉูุฏ ุฒุฑ ุฑุง ูุธุงุฑุช ฺฉูุฏ:

1. **ุฒูุงู ูพุงุณุฎ**: ุงูุฏุงุฒูโฺฏุฑ ูุงูฺฏู ุฒูุงู ุจุฑุง ูุฑ ูพุงุณุฎ
2. **ูุตุฑู ุญุงูุธู**: ูุธุงุฑุช ุจุฑ ูุตุฑู ุฑู
3. **ุงุณุชูุงุฏู ุงุฒ CPU**: ุจุฑุฑุณ ุจุงุฑ ูพุฑุฏุงุฒูุฏู
4. **ฺฉูุช ุฎุฑูุฌ**: ุงุฑุฒุงุจ ุงุฑุชุจุงุท ู ุงูุณุฌุงู ูพุงุณุฎโูุง

### ฺฺฉโูุณุช ุงุนุชุจุงุฑุณูุฌ ฺฉูุช

- โ ูุฏู ุจู ุทูุฑ ููุงุณุจ ุจู ูพุฑุณุดโูุง ุญูุฒู ุชูุธูโุดุฏู ูพุงุณุฎ ูโุฏูุฏ
- โ ูุงูุจ ูพุงุณุฎ ุจุง ุณุงุฎุชุงุฑ ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ ูุทุงุจูุช ุฏุงุฑุฏ
- โ ูฺ ูุดุช ุญุงูุธู ุฏุฑ ุทูู ุงุณุชูุงุฏู ุทููุงูโูุฏุช ูุฌูุฏ ูุฏุงุฑุฏ
- โ ุนููฺฉุฑุฏ ุซุงุจุช ุฏุฑ ุทูู ูุฑูุฏโูุง ูุฎุชูู
- โ ูุฏุฑุช ุตุญุญ ููุงุฑุฏ ุฎุงุต ู ูุฑูุฏโูุง ูุงูุนุชุจุฑ

## ุฎูุงุตู

ุชุจุฑฺฉ! ุดูุง ุจุง ููููุช ููุงุฑุฏ ุฒุฑ ุฑุง ุชฺฉูู ฺฉุฑุฏุฏ:

- โ ุชุจุฏู ูุฑูุช ูุฏู ุชูุธูโุดุฏู
- โ ุจูููโุณุงุฒ ฺฉูููโุณุงุฒ ูุฏู
- โ ูพฺฉุฑุจูุฏ ุงุณุชูุฑุงุฑ Foundry Local
- โ ุชูุธู ุนููฺฉุฑุฏ ู ุฑูุน ูุดฺฉูุงุช

---

**ุณูุจ ูุณุฆููุช**:  
ุงู ุณูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ุณุฑูุณ ุชุฑุฌูู ููุด ูุตููุน [Co-op Translator](https://github.com/Azure/co-op-translator) ุชุฑุฌูู ุดุฏู ุงุณุช. ุฏุฑ ุญุงู ฺฉู ูุง ุชูุงุด ูโฺฉูู ุฏูุช ุฑุง ุญูุธ ฺฉููุ ูุทูุงู ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุชุฑุฌููโูุง ุฎูุฏฺฉุงุฑ ููฺฉู ุงุณุช ุดุงูู ุฎุทุงูุง ุง ูุงุฏุฑุณุชโูุง ุจุงุดูุฏ. ุณูุฏ ุงุตู ุจู ุฒุจุงู ุงุตู ุขู ุจุงุฏ ุจู ุนููุงู ููุจุน ูุนุชุจุฑ ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดูุฏ. ุจุฑุง ุงุทูุงุนุงุช ุญุณุงุณุ ุชูุตู ูโุดูุฏ ุงุฒ ุชุฑุฌูู ุญุฑููโุง ุงูุณุงู ุงุณุชูุงุฏู ฺฉูุฏ. ูุง ูุณุฆููุช ุฏุฑ ูุจุงู ุณูุกุชูุงููโูุง ุง ุชูุณุฑูุง ูุงุฏุฑุณุช ูุงุด ุงุฒ ุงุณุชูุงุฏู ุงุฒ ุงู ุชุฑุฌูู ูุฏุงุฑู.
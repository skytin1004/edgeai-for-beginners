<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "ad0c054ebd3de404d997d1707a513c70",
  "translation_date": "2025-09-19T01:20:15+00:00",
  "source_file": "Module05/04.SLMOps.Deployment.md",
  "language_code": "sl"
}
-->
# Poglavje 4: Implementacija modela, pripravljenega za produkcijo

## Pregled

Ta obseÅ¾en vodiÄ vas bo korak za korakom vodil skozi celoten proces nameÅ¡Äanja fino uglaÅ¡enih kvantiziranih modelov z uporabo Foundry Local. Pokrili bomo pretvorbo modela, optimizacijo kvantizacije in konfiguracijo namestitve od zaÄetka do konca.

## Predpogoji

Preden zaÄnete, poskrbite, da imate naslednje:

- âœ… Fino uglaÅ¡en onnx model, pripravljen za namestitev
- âœ… RaÄunalnik z operacijskim sistemom Windows ali Mac
- âœ… Python 3.10 ali novejÅ¡i
- âœ… Vsaj 8GB razpoloÅ¾ljivega RAM-a
- âœ… Foundry Local nameÅ¡Äen na vaÅ¡em sistemu

## 1. del: Nastavitev okolja

### Namestitev potrebnih orodij

Odprite terminal (Command Prompt na Windowsu, Terminal na Macu) in zaporedoma zaÅ¾enite naslednje ukaze:

```bash
# Update transformers library to the latest version
pip install transformers -U

# Install Microsoft Olive (model conversion tool)
pip install git+https://github.com/microsoft/Olive.git

# Install ONNX Runtime GenAI
git clone https://github.com/microsoft/onnxruntime-genai
cd onnxruntime-genai && python build.py --config Release
pip install {Your build release path}/onnxruntime_genai-0.9.0.dev0-cp311-cp311-linux_x86_64.whl

# Install additional dependencies
pip install onnx onnxruntime numpy
```

âš ï¸ **Pomembno obvestilo**: Potrebovali boste tudi CMake razliÄice 3.31 ali novejÅ¡e, ki ga lahko prenesete z [cmake.org](https://cmake.org/download/).

## 2. del: Pretvorba modela in kvantizacija

### Izbira pravega formata

Za fino uglaÅ¡ene manjÅ¡e jezikovne modele priporoÄamo uporabo **ONNX formata**, ker ponuja:

- ğŸš€ BoljÅ¡o optimizacijo zmogljivosti
- ğŸ”§ Neodvisnost od strojne opreme
- ğŸ­ ZmoÅ¾nosti za produkcijo
- ğŸ“± ZdruÅ¾ljivost med platformami

### Metoda 1: Pretvorba z enim ukazom (priporoÄeno)

Uporabite naslednji ukaz za neposredno pretvorbo vaÅ¡ega fino uglaÅ¡enega modela:

```bash
olive auto-opt \
    --model_name_or_path /path/to/your/finetuned/model \
    --device cpu \
    --provider CPUExecutionProvider \
    --use_model_builder \
    --precision int4 \
    --output_path models/your-model-name/onnx \
    --log_level 1
```

**Pojasnilo parametrov:**
- `--model_name_or_path`: Pot do vaÅ¡ega fino uglaÅ¡enega modela
- `--device cpu`: Uporaba CPU za optimizacijo
- `--precision int4`: Uporaba INT4 kvantizacije (pribliÅ¾no 75% zmanjÅ¡anje velikosti)
- `--output_path`: Pot za shranjevanje pretvorjenega modela

### Metoda 2: Pristop z uporabo konfiguracijske datoteke (za napredne uporabnike)

Ustvarite konfiguracijsko datoteko z imenom `finetuned_conversion_config.json`:

```json
{
    "input_model": {
        "type": "HfModel",
        "model_path": "/path/to/your/finetuned/model",
        "task": "text-generation"
    },
    "systems": {
        "local_system": {
            "type": "LocalSystem",
            "accelerators": [
                {
                    "execution_providers": [
                        "CPUExecutionProvider"
                    ]
                }
            ]
        }
    },
    "passes": {
        "builder": {
            "type": "ModelBuilder",
            "config": {
                "precision": "int4",
                "quantization_config": {
                    "block_size": 128,
                    "is_symmetric": false
                }
            }
        }
    },
    "host": "local_system",
    "target": "local_system",
    "cache_dir": "cache",
    "output_dir": "models/output/your-finetuned-model-onnx"
}
```

Nato zaÅ¾enite:

```bash
olive run --config ./finetuned_conversion_config.json
```

### Primerjava moÅ¾nosti kvantizacije

| NatanÄnost | Velikost datoteke | Hitrost sklepanja | Kakovost modela | PriporoÄena uporaba |
|------------|-------------------|-------------------|-----------------|---------------------|
| FP16       | Osnovna Ã— 0.5     | Hitro             | NajboljÅ¡a       | Napredna strojna oprema |
| INT8       | Osnovna Ã— 0.25    | Zelo hitro        | Dobra           | UravnoteÅ¾ena izbira |
| INT4       | Osnovna Ã— 0.125   | NajhitrejÅ¡a       | Sprejemljiva    | Omejeni viri |

ğŸ’¡ **PriporoÄilo**: Za prvo namestitev zaÄnite z INT4 kvantizacijo. ÄŒe kakovost ni zadovoljiva, poskusite z INT8 ali FP16.

## 3. del: Konfiguracija namestitve Foundry Local

### Ustvarjanje konfiguracije modela

Pomaknite se do direktorija modelov Foundry Local:

```bash
foundry cache cd ./models/
```

Ustvarite strukturo direktorija za vaÅ¡ model:

```bash
mkdir -p ./models/custom/your-finetuned-model
```

Ustvarite konfiguracijsko datoteko `inference_model.json` v direktoriju vaÅ¡ega modela:

```json
{
  "Name": "your-finetuned-model-int4",
  "Description": "Fine-tuned quantized model",
  "Version": "1.0",
  "PromptTemplate": {
    "system": "<|im_start|>system\n{Content}<|im_end|>",
    "user": "<|im_start|>user\n{Content}<|im_end|>",
    "assistant": "<|im_start|>assistant\n{Content}<|im_end|>",
    "prompt": "<|im_start|>user\n{Content}<|im_end|>\n<|im_start|>assistant"
  },
  "ModelConfig": {
    "max_length": 2048,
    "temperature": 0.7,
    "top_p": 0.9,
    "repetition_penalty": 1.1
  }
}
```

### Predloge konfiguracij za specifiÄne modele

#### Za modele serije Qwen:

```json
{
  "Name": "qwen-finetuned-int4",
  "PromptTemplate": {
    "system": "<|im_start|>system\n{Content}<|im_end|>",
    "user": "<|im_start|>user\n{Content}<|im_end|>",
    "assistant": "<|im_start|>assistant\n{Content}<|im_end|>",
    "prompt": "<|im_start|>user\n{Content}<|im_end|>\n<|im_start|>assistant"
  }
}
```

## 4. del: Testiranje in optimizacija modela

### Preverjanje namestitve modela

Preverite, ali Foundry Local prepozna vaÅ¡ model:

```bash
foundry cache ls
```

Videti bi morali `your-finetuned-model-int4` na seznamu.

### ZaÄetek testiranja modela

```bash
foundry model run your-finetuned-model-int4
```

### Primerjava zmogljivosti

Med testiranjem spremljajte kljuÄne metrike:

1. **ÄŒas odziva**: Merite povpreÄni Äas na odziv
2. **Poraba pomnilnika**: Spremljajte porabo RAM-a
3. **Uporaba CPU**: Preverite obremenitev procesorja
4. **Kakovost izhoda**: Ocenite ustreznost in koherenco odzivov

### Kontrolni seznam za validacijo kakovosti

- âœ… Model ustrezno odgovarja na vpraÅ¡anja iz fino uglaÅ¡enega podroÄja
- âœ… Format odziva ustreza priÄakovani strukturi izhoda
- âœ… Brez uhajanja pomnilnika med daljÅ¡o uporabo
- âœ… Dosledna zmogljivost pri razliÄnih dolÅ¾inah vhodnih podatkov
- âœ… Pravilno obravnavanje mejnih primerov in neveljavnih vhodov

## Povzetek

ÄŒestitamo! UspeÅ¡no ste zakljuÄili:

- âœ… Pretvorbo formata fino uglaÅ¡enega modela
- âœ… Optimizacijo kvantizacije modela
- âœ… Konfiguracijo namestitve Foundry Local
- âœ… Prilagoditev zmogljivosti in odpravljanje teÅ¾av

---

**Omejitev odgovornosti**:  
Ta dokument je bil preveden z uporabo storitve za prevajanje z umetno inteligenco [Co-op Translator](https://github.com/Azure/co-op-translator). ÄŒeprav si prizadevamo za natanÄnost, vas prosimo, da upoÅ¡tevate, da lahko avtomatizirani prevodi vsebujejo napake ali netoÄnosti. Izvirni dokument v njegovem maternem jeziku je treba obravnavati kot avtoritativni vir. Za kljuÄne informacije priporoÄamo profesionalni ÄloveÅ¡ki prevod. Ne prevzemamo odgovornosti za morebitna nesporazume ali napaÄne razlage, ki bi nastale zaradi uporabe tega prevoda.